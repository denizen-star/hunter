<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Dashboard - Hunter</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    
    <!-- Google Fonts - Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --bg-hover: #f9fafb;
            --bg-active: #f3f4f6;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            --border-primary: #e5e7eb;
            --accent-blue: #3b82f6;
            --accent-blue-hover: #2563eb;
            --accent-blue-light: #eff6ff;
            --accent-green: #10b981;
            --font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family);
            background: var(--bg-secondary);
            margin: 0;
            padding: 0;
        }
        
        .main-wrapper {
            margin-left: 180px;
        }
        
        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 180px;
            height: 100vh;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-primary);
            z-index: 1000;
            padding: var(--space-md) 0;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border-primary);
            margin-bottom: var(--space-md);
        }
        
        .sidebar-header h3 {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar-menu li {
            margin: 0;
        }
        
        .sidebar-menu a {
            display: block;
            padding: 12px var(--space-lg);
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
            font-size: 14px;
        }
        
        .sidebar-menu a:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-left-color: var(--accent-blue);
        }
        
        .sidebar-menu a.active {
            background: var(--bg-active);
            color: var(--text-primary);
            border-left-color: var(--accent-blue);
        }
        
        .container {
            width: calc(100vw - 180px);
            padding: 24px;
            box-sizing: border-box;
        }
        
        /* Hero Header */
        .hero-header {
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            padding: 8px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .hero-header-period {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .hero-header-top {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 4px;
            flex: 1;
        }
        
        .hero-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
            text-align: left;
        }
        
        .hero-header-period {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .period-selector {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            background: var(--bg-primary);
            padding: 4px;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            width: fit-content;
        }
        
        .period-btn {
            padding: 8px var(--space-md);
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .period-btn:hover {
            background: var(--bg-active);
            color: var(--text-primary);
        }
        
        .period-btn.active {
            background: var(--accent-blue);
            color: #ffffff;
        }
        
        .period-btn.export {
            background: var(--accent-green);
            color: #ffffff;
            margin-left: 8px;
        }
        
        .period-btn.export:hover {
            background: #059669;
        }
        
        .filter-dropdown {
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
        }
        
        .filter-dropdown:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        /* Company Search Autocomplete */
        .company-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-md);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 4px;
        }
        
        .company-suggestion-item {
            padding: 10px 12px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-light);
            transition: background-color 0.2s ease;
        }
        
        .company-suggestion-item:last-child {
            border-bottom: none;
        }
        
        .company-suggestion-item:hover {
            background-color: var(--bg-hover);
        }
        
        .company-suggestion-item.highlighted {
            background-color: var(--accent-blue-light);
        }
        
        .company-suggestion-item.selected {
            background-color: var(--accent-blue-light);
            font-weight: 500;
        }
        
        .company-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: var(--accent-blue-light);
            color: var(--accent-blue);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .company-tag-remove {
            cursor: pointer;
            font-weight: bold;
            color: var(--accent-blue);
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .company-tag-remove:hover {
            opacity: 1;
        }
        
        /* Stat Cards */
        .stat-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 6px;
            margin: 0;
            padding: 6px;
            width: 100%;
            box-sizing: border-box;
            background: transparent;
        }
        
        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            padding: 6px;
            text-align: center;
            box-shadow: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .stat-card:hover {
            box-shadow: var(--shadow-sm);
            transform: translateY(-1px);
            border-color: var(--accent-blue);
        }
        
        .stat-card.active {
            border: 1px solid var(--accent-blue);
            background: var(--accent-blue-light);
        }
        
        .stat-number {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1px;
            line-height: 1.2;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 10px;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .dashboard-stats-container {
            padding: 0;
            margin: 0;
            margin-top: 0;
            width: 100%;
            box-sizing: border-box;
            background: transparent;
        }
        
        /* Collapsible Filter Boxes */
        .filter-box {
            background: var(--bg-primary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-sm);
        }
        
        .filter-box-header {
            padding: var(--space-md) var(--space-lg);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }
        
        .filter-box-header:hover {
            background: var(--bg-hover);
        }
        
        .filter-box-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-box-header h3::before {
            content: '';
            width: 2px;
            height: 14px;
            background: linear-gradient(180deg, #3b82f6, #10b981);
            border-radius: 2px;
        }
        
        .filter-box-header .collapse-icon {
            font-size: 14px;
            color: var(--text-secondary);
            transition: transform 0.2s ease;
        }
        
        .filter-box.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
        
        .filter-box-body {
            padding: var(--space-lg);
        }
        
        .filter-box.collapsed .filter-box-body {
            display: none;
        }
        
        .filter-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 400;
            border-radius: 8px;
            border: 2px solid var(--border-primary);
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .filter-btn:hover {
            background: var(--bg-hover);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.15);
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .filter-btn .count {
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 400;
            min-width: 18px;
            text-align: center;
        }
        
        .filter-btn.active .count {
            background: rgba(255, 255, 255, 0.25);
        }
        
        /* Sort Controls */
        .sort-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-primary);
        }
        
        .sort-controls h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
        }
        
        .sort-select {
            padding: 10px 16px;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: var(--font-family);
            cursor: pointer;
        }
        
        .sort-select:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        /* Unified Grid */
        .unified-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        /* Application Card Styles */
        .card {
            background: var(--bg-primary);
            border-radius: 14px;
            padding: 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
        }
        
        .card:hover {
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.2);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .card-company {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            flex: 1;
        }
        
        .match-score {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-blue);
        }
        
        .flag-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            opacity: 0.3;
            transition: all 0.15s ease;
        }
        
        .flag-btn:hover {
            opacity: 1;
            transform: scale(1.2);
        }
        
        .flag-btn.flagged {
            opacity: 1;
        }
        
        .card-title {
            font-size: 15px;
            color: var(--text-secondary);
            margin: 4px 0;
            font-weight: 500;
        }
        
        .card-status {
            display: inline-block;
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 600;
            border-radius: 6px;
            margin-top: 8px;
            background: var(--bg-hover);
            color: var(--text-secondary);
        }
        
        .card-meta {
            margin-top: 14px;
            font-size: 13px;
            color: var(--text-tertiary);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .card-btn {
            width: 100%;
            margin-top: 16px;
            padding: 10px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            border: 1px solid var(--border-primary);
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.15s ease;
            text-decoration: none;
            display: block;
            text-align: center;
        }
        
        .card-btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }
        
        /* Contact Tile Styles */
        .contact-tile {
            background: white;
            border-radius: 14px;
            padding: 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
        }
        
        .contact-tile:hover {
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.2);
        }
        
        .contact-tile.timing-white { border-left: 4px solid #e5e7eb; }
        .contact-tile.timing-green { border-left: 4px solid #10b981; }
        .contact-tile.timing-yellow { border-left: 4px solid #f59e0b; }
        .contact-tile.timing-red { border-left: 4px solid #ef4444; }
        .contact-tile.timing-blue { border-left: 4px solid #3b82f6; }
        .contact-tile.timing-gray { border-left: 4px solid #6b7280; }
        
        .contact-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .contact-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }
        
        .contact-company {
            font-size: 15px;
            color: var(--text-secondary);
            margin: 4px 0;
            font-weight: 500;
        }
        
        .contact-title {
            font-size: 14px;
            color: var(--text-tertiary);
            margin: 4px 0;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 600;
            border-radius: 6px;
            margin-top: 8px;
            background: var(--bg-hover);
            color: var(--text-secondary);
        }
        
        .next-step-section {
            margin-top: 16px;
            padding: 12px;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 10px;
            border-left: 4px solid #3b82f6;
        }
        
        .next-step-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: #1e40af;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .next-step-label::before {
            content: '‚Üí';
            font-size: 14px;
            font-weight: 700;
        }
        
        .next-step-text {
            font-size: 12px;
            color: #1e3a8a;
            line-height: 1.5;
            font-weight: 500;
        }
        
        .contact-dates {
            margin-top: 14px;
            font-size: 13px;
            color: var(--text-tertiary);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .date-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            grid-column: 1 / -1;
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        
        .empty-state h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }
        
        .empty-state p {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0 0 24px 0;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>Hunter</h3>
        </div>
        <ul class="sidebar-menu">
            <li><a href="/dashboard" class="nav-link">App Dash</a></li>
            <li><a href="/new-application" class="nav-link">New Application</a></li>
            <li><a href="/networking" class="nav-link">Network Dash</a></li>
            <li><a href="/new-networking-contact" class="nav-link">New Contact</a></li>
            <li><a href="/templates" class="nav-link">Templates</a></li>
            <li><a href="/progress" class="nav-link active">Progress</a></li>
            <li><a href="/reports" class="nav-link">Reports</a></li>
            <li><a href="/analytics" class="nav-link">Analytics</a></li>
            <li><a href="/daily-activities" class="nav-link">Daily Activities</a></li>
            <li><a href="#" onclick="showAIStatus(); return false;" class="nav-link">Check AI Status</a></li>
            <li><a href="/new-application?resume=true" class="nav-link">Manage Resume</a></li>
        </ul>
    </div>

    <!-- Main Wrapper -->
    <div class="main-wrapper">
    <!-- Hero Header -->
    <div class="hero-header">
        <div class="hero-header-top">
            <h1>Progress Dashboard</h1>
        </div>
        <div class="hero-header-period">
            <!-- Type Filter -->
            <div class="period-selector" style="margin-right: 16px;">
                <button class="period-btn" data-type="jobs" onclick="selectType('jobs')">Jobs</button>
                <button class="period-btn" data-type="networking" onclick="selectType('networking')">Networking</button>
                <button class="period-btn active" data-type="both" onclick="selectType('both')">Both</button>
            </div>
            <!-- Period Filter -->
            <div class="period-selector">
                <button class="period-btn" data-period="today" onclick="selectPeriod('today')">Today</button>
                <button class="period-btn" data-period="yesterday" onclick="selectPeriod('yesterday')">Yesterday</button>
                <button class="period-btn" data-period="7days" onclick="selectPeriod('7days')">7 Days</button>
                <button class="period-btn" data-period="30days" onclick="selectPeriod('30days')">30 Days</button>
                <button class="period-btn active" data-period="all" onclick="selectPeriod('all')">All Time</button>
            </div>
        </div>
        <div class="hero-header-search-row" style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px; width: 100%;">
            <!-- Company Search Filter (Left Aligned) -->
            <div class="search-filter-container" style="position: relative; min-width: 250px;">
                <div style="display: flex; flex-wrap: wrap; gap: 4px; align-items: center; padding: 4px 36px 4px 4px; border: 1px solid #e5e7eb; border-radius: 6px; background: #fff; min-height: 36px;">
                    <div id="selectedCompanies" style="display: flex; flex-wrap: wrap; gap: 4px; flex: 1;"></div>
                    <input type="text" 
                           id="companyFilter" 
                           class="search-input" 
                           placeholder="Search companies..." 
                           oninput="handleCompanySearch(event)"
                           onfocus="handleCompanySearchFocus()"
                           onblur="hideCompanySuggestions()"
                           autocomplete="off"
                           style="border: none; outline: none; font-size: 14px; flex: 1; min-width: 120px; padding: 4px 0;">
                </div>
                <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #6b7280; pointer-events: none; z-index: 1;">üîç</span>
                <div id="companySuggestions" class="company-suggestions" style="display: none;"></div>
            </div>
            <!-- Sort Dropdown (Right Aligned) -->
            <select id="sortSelect" class="filter-dropdown" onchange="applySort()" style="margin-left: auto;">
                <option value="updated_desc">Updated (Newest First)</option>
                <option value="updated_asc">Updated (Oldest First)</option>
                <option value="created_desc">Created/Applied (Newest First)</option>
                <option value="created_asc">Created/Applied (Oldest First)</option>
                <option value="match_desc">Match % (Highest First)</option>
                <option value="match_asc">Match % (Lowest First)</option>
                <option value="company_asc">Company (A-Z)</option>
                <option value="company_desc">Company (Z-A)</option>
                <option value="position_asc">Position (A-Z)</option>
                <option value="position_desc">Position (Z-A)</option>
            </select>
        </div>
    </div>
    
    <!-- Stats -->
    <div class="dashboard-stats-container">
        <div class="stat-cards-grid" id="statsGrid"></div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Combined Filters (Collapsible) -->
        <div class="filter-box collapsed" id="combinedFiltersBox">
            <div class="filter-box-header" onclick="toggleFilterBox('combinedFiltersBox')">
                <h3>FILTERS</h3>
                <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="filter-box-body">
                <!-- Application Status Filters -->
                <div id="appFiltersSection" style="margin-bottom: 24px;">
                    <h4 style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">üíº Status Filters</h4>
                    <div class="filter-buttons" id="appStatusFilters">
                        <button class="filter-btn" data-filter-type="status" data-filter="all">
                            All <span class="count" id="count-all">0</span>
                        </button>
                        <button class="filter-btn active" data-filter-type="status" data-filter="active">
                            Active <span class="count" id="count-active">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="status" data-filter="pending">
                            Pending <span class="count" id="count-pending">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="status" data-filter="applied">
                            Applied <span class="count" id="count-applied">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="status" data-filter="contacted">
                            Contacted <span class="count" id="count-contacted">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="status" data-filter="company">
                            Company <span class="count" id="count-company">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="status" data-filter="scheduled">
                            Scheduled <span class="count" id="count-scheduled">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="status" data-filter="offered">
                            Offered <span class="count" id="count-offered">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="status" data-filter="rejected">
                            Rejected <span class="count" id="count-rejected">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="status" data-filter="Inactive/Dormant">
                            Inactive <span class="count" id="count-inactive">0</span>
                        </button>
                    </div>
                </div>
                
                <!-- Networking Status Filters and Activity Timing -->
                <div id="networkingFiltersSection">
                    <h4 style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">ü§ù Networking Filters</h4>
                    <div class="filter-buttons" style="display: flex; flex-wrap: nowrap; gap: 8px; overflow-x: auto;">
                        <!-- Networking Status Filters -->
                        <button class="filter-btn active" data-filter-type="networking-status" data-filter="all" id="networking-status-all">
                            All <span class="count" id="count-networking-all">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="networking-status" data-filter="To Research" id="networking-status-to-research">
                            To Research <span class="count" id="count-networking-research">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="networking-status" data-filter="Contacted" id="networking-status-contacted">
                            Contacted <span class="count" id="count-networking-contacted">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="networking-status" data-filter="In Conversation" id="networking-status-conversation">
                            In Conversation <span class="count" id="count-networking-conversation">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="networking-status" data-filter="Meeting Scheduled" id="networking-status-meetings">
                            Meetings <span class="count" id="count-networking-meetings">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="networking-status" data-filter="Inactive/Dormant" id="networking-status-inactive">
                            Inactive <span class="count" id="count-networking-inactive">0</span>
                        </button>
                        <!-- Activity Timing Filters -->
                        <button class="filter-btn active" data-filter-type="timing" data-timing="all" id="timing-all">
                            All <span class="count" id="count-timing-all">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="timing" data-timing="white" style="border-left: 4px solid #e5e7eb;" title="Recent" id="timing-white">
                            &lt;7d <span class="count" id="count-recent">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="timing" data-timing="green" style="border-left: 4px solid #10b981;" title="Needs Activity" id="timing-green">
                            8-15d <span class="count" id="count-needs">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="timing" data-timing="yellow" style="border-left: 4px solid #f59e0b;" title="Approaching" id="timing-yellow">
                            15-30d <span class="count" id="count-approaching">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="timing" data-timing="red" style="border-left: 4px solid #ef4444;" title="Overdue" id="timing-red">
                            30-60d <span class="count" id="count-overdue">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="timing" data-timing="blue" style="border-left: 4px solid #3b82f6;" title="Nurture" id="timing-blue">
                            60-90d <span class="count" id="count-nurture">0</span>
                        </button>
                        <button class="filter-btn" data-filter-type="timing" data-timing="gray" style="border-left: 4px solid #6b7280;" title="Cold" id="timing-gray">
                            &gt;90d <span class="count" id="count-cold">0</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        
        <!-- Unified Grid -->
        <div class="unified-grid" id="unifiedGrid"></div>
    </div>
    </div>

    <script>
        let allData = {
            applications: [],
            contacts: [],
            appStats: {},
            contactStats: {},
            combinedStats: {},
            companies: [],
            positions: []
        };
        
        let currentType = 'both';
        let currentPeriod = 'all';
        let currentStatusFilter = 'active';
        let currentNetworkingStatusFilter = 'all';
        let currentTimingFilter = 'all';
        let currentCompanyFilter = []; // Array to store selected companies
        let currentPositionFilter = '';
        let currentSort = 'updated_desc';

        // Load data on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded - initializing...');
            // Initialize filter box visibility
            selectType(currentType);
            setupFilterButtons();
            // loadProgressData() is called by selectType(), so we don't need to call it again
            
            // Setup keyboard navigation for company search
            setupCompanySearchKeyboard();
        });
        
        function setupCompanySearchKeyboard() {
            const companyInput = document.getElementById('companyFilter');
            if (companyInput) {
                companyInput.addEventListener('keydown', (e) => {
                    const suggestionsDiv = document.getElementById('companySuggestions');
                    const items = suggestionsDiv ? suggestionsDiv.querySelectorAll('.company-suggestion-item:not([style*="cursor: default"])') : [];
                    const highlighted = suggestionsDiv ? suggestionsDiv.querySelector('.company-suggestion-item.highlighted') : null;
                    
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        if (items.length > 0) {
                            if (highlighted) {
                                const currentIndex = Array.from(items).indexOf(highlighted);
                                const nextIndex = (currentIndex + 1) % items.length;
                                highlighted.classList.remove('highlighted');
                                items[nextIndex].classList.add('highlighted');
                                items[nextIndex].scrollIntoView({ block: 'nearest' });
                            } else {
                                items[0].classList.add('highlighted');
                            }
                        }
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        if (items.length > 0) {
                            if (highlighted) {
                                const currentIndex = Array.from(items).indexOf(highlighted);
                                const prevIndex = currentIndex === 0 ? items.length - 1 : currentIndex - 1;
                                highlighted.classList.remove('highlighted');
                                items[prevIndex].classList.add('highlighted');
                                items[prevIndex].scrollIntoView({ block: 'nearest' });
                            } else {
                                items[items.length - 1].classList.add('highlighted');
                            }
                        }
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        if (highlighted) {
                            // Get company name from highlighted item (first span contains the name)
                            const firstSpan = highlighted.querySelector('span:first-child');
                            const companyText = firstSpan ? firstSpan.textContent.trim() : highlighted.textContent.replace('‚úì', '').trim();
                            toggleCompany(companyText);
                        } else if (items.length > 0) {
                            const firstItem = items[0];
                            const firstSpan = firstItem.querySelector('span:first-child');
                            const companyText = firstSpan ? firstSpan.textContent.trim() : firstItem.textContent.replace('‚úì', '').trim();
                            toggleCompany(companyText);
                        } else {
                            // If no suggestions, just hide dropdown
                            hideCompanySuggestions();
                        }
                    } else if (e.key === 'Escape') {
                        hideCompanySuggestions();
                        companyInput.blur();
                    } else if (e.key === 'Backspace' && companyInput.value === '' && currentCompanyFilter.length > 0) {
                        // Remove last selected company if input is empty and backspace is pressed
                        currentCompanyFilter.pop();
                        updateSelectedCompaniesDisplay();
                        renderItems();
                    }
                });
            }
        }

        async function loadProgressData() {
            try {
                // For multiple companies, we'll filter client-side, so send empty string to get all data
                const params = new URLSearchParams({
                    type: currentType,
                    period: currentPeriod,
                    company: '', // We filter client-side for multiple companies
                    position: currentPositionFilter,
                    status: currentStatusFilter,
                    networking_status: currentNetworkingStatusFilter,
                    timing: currentTimingFilter
                });
                
                console.log('Loading progress data with filters:', {
                    type: currentType,
                    period: currentPeriod,
                    company: currentCompanyFilter,
                    position: currentPositionFilter,
                    status: currentStatusFilter,
                    networking_status: currentNetworkingStatusFilter,
                    timing: currentTimingFilter
                });
                
                const response = await fetch(`/api/progress?${params}`);
                if (!response.ok) {
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                
                if (data.success) {
                    console.log('API returned:', {
                        applications: data.applications?.length || 0,
                        contacts: data.contacts?.length || 0,
                        type: currentType,
                        period: currentPeriod
                    });
                    
                    // Clear and update allData
                    allData.applications = data.applications || [];
                    allData.contacts = data.contacts || [];
                    allData.appStats = data.app_stats || {};
                    allData.contactStats = data.contact_stats || {};
                    allData.combinedStats = data.combined_stats || {};
                    allData.companies = data.companies || [];
                    allData.positions = data.positions || [];
                    
                    console.log('allData updated:', {
                        applications: allData.applications.length,
                        contacts: allData.contacts.length
                    });
                    
                    updateStats();
                    updateFilterCounts();
                    updateSelectedCompaniesDisplay();
                    renderItems();
                    
                    // Update company suggestions if search input has focus
                    const companyInput = document.getElementById('companyFilter');
                    if (companyInput === document.activeElement) {
                        showCompanySuggestions(companyInput.value || '');
                    }
                } else {
                    console.error('API returned error:', data.error);
                }
            } catch (error) {
                console.error('Error loading progress data:', error);
            }
        }

        function generateStatCards(stats, cardConfig) {
            return cardConfig.map(stat => {
                const count = (stats && stats[stat.key]) || 0;
                return `
                    <div class="stat-card" data-stat="${stat.key}">
                        <div class="stat-number">${count}</div>
                        <div class="stat-label">${stat.label}</div>
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            const statsGrid = document.getElementById('statsGrid');
            let html = '';
            
            if (currentType === 'jobs') {
                const appStatCards = [
                    { key: 'active', label: 'Active' },
                    { key: 'all', label: 'All' },
                    { key: 'flagged', label: 'Flagged' },
                    { key: 'pending', label: 'Pending' },
                    { key: 'applied', label: 'Applied' },
                    { key: 'contacted', label: 'Contacted' },
                    { key: 'company', label: 'Company' },
                    { key: 'scheduled', label: 'Scheduled' },
                    { key: 'follow-up', label: 'Follow Up' },
                    { key: 'offered', label: 'Offered' },
                    { key: 'rejected', label: 'Rejected' },
                    { key: 'accepted', label: 'Accepted' }
                ];
                html = generateStatCards(allData.appStats, appStatCards);
            } else if (currentType === 'networking') {
                const contactStatCards = [
                    { key: 'total', label: 'Total Contacts' },
                    { key: 'active', label: 'Active' },
                    { key: 'meetings', label: 'Meetings' },
                    { key: 'partners', label: 'Partners' }
                ];
                html = generateStatCards(allData.contactStats, contactStatCards);
            } else {
                const combinedStatCards = [
                    { key: 'active', label: 'Active' },
                    { key: 'all', label: 'All' },
                    { key: 'flagged', label: 'Flagged' }
                ];
                html = generateStatCards(allData.combinedStats, combinedStatCards);
            }
            
            statsGrid.innerHTML = html;
        }

        function updateFilterCounts() {
            // Update application status filter counts from API stats
            if (allData.appStats) {
                const appCounts = {
                    'all': allData.appStats.all || 0,
                    'active': allData.appStats.active || 0,
                    'pending': allData.appStats.pending || 0,
                    'applied': allData.appStats.applied || 0,
                    'contacted': allData.appStats.contacted || 0,
                    'company': allData.appStats.company || 0,
                    'scheduled': allData.appStats.scheduled || 0,
                    'offered': allData.appStats.offered || 0,
                    'rejected': allData.appStats.rejected || 0,
                    'inactive': allData.appStats.inactive || 0
                };
                
                Object.keys(appCounts).forEach(key => {
                    const countEl = document.getElementById(`count-${key}`);
                    if (countEl) countEl.textContent = appCounts[key];
                });
            }
            
            // Update networking status filter counts from API stats
            if (allData.contactStats && allData.contactStats.total !== undefined) {
                // Use stats from API (calculated from full dataset)
                const networkingCounts = {
                    'networking-all': allData.contactStats.total || 0,
                    'networking-research': allData.contactStats.to_research || 0,
                    'networking-contacted': allData.contactStats.contacted || 0,
                    'networking-conversation': allData.contactStats.in_conversation || 0,
                    'networking-meetings': allData.contactStats.meetings || 0,
                    'networking-inactive': allData.contactStats.inactive || 0
                };
                
                Object.keys(networkingCounts).forEach(key => {
                    const countEl = document.getElementById(`count-${key}`);
                    if (countEl) countEl.textContent = networkingCounts[key];
                });
                
                // Timing counts from API
                const timingCounts = {
                    'timing-all': allData.contactStats.total || 0,
                    'recent': allData.contactStats.timing_white || 0,
                    'needs': allData.contactStats.timing_green || 0,
                    'approaching': allData.contactStats.timing_yellow || 0,
                    'overdue': allData.contactStats.timing_red || 0,
                    'nurture': allData.contactStats.timing_blue || 0,
                    'cold': allData.contactStats.timing_gray || 0
                };
                
                Object.keys(timingCounts).forEach(key => {
                    const countEl = document.getElementById(`count-${key}`);
                    if (countEl) countEl.textContent = timingCounts[key];
                });
            } else {
                // Fallback: calculate from contacts array if stats not available
                if (allData.contacts && allData.contacts.length > 0) {
                    const networkingCounts = {
                        'networking-all': allData.contacts.length,
                        'networking-research': allData.contacts.filter(c => c.status === 'To Research').length,
                        'networking-contacted': allData.contacts.filter(c => c.status && c.status.includes('Contacted')).length,
                        'networking-conversation': allData.contacts.filter(c => c.status === 'In Conversation').length,
                        'networking-meetings': allData.contacts.filter(c => c.status === 'Meeting Scheduled').length,
                        'networking-inactive': allData.contacts.filter(c => c.status === 'Inactive/Dormant').length
                    };
                    
                    Object.keys(networkingCounts).forEach(key => {
                        const countEl = document.getElementById(`count-${key}`);
                        if (countEl) countEl.textContent = networkingCounts[key];
                    });
                    
                    const timingCounts = {
                        'timing-all': allData.contacts.length,
                        'recent': allData.contacts.filter(c => c.timing_color === 'white').length,
                        'needs': allData.contacts.filter(c => c.timing_color === 'green').length,
                        'approaching': allData.contacts.filter(c => c.timing_color === 'yellow').length,
                        'overdue': allData.contacts.filter(c => c.timing_color === 'red').length,
                        'nurture': allData.contacts.filter(c => c.timing_color === 'blue').length,
                        'cold': allData.contacts.filter(c => c.timing_color === 'gray').length
                    };
                    
                    Object.keys(timingCounts).forEach(key => {
                        const countEl = document.getElementById(`count-${key}`);
                        if (countEl) countEl.textContent = timingCounts[key];
                    });
                } else {
                    // Reset all networking counts to 0
                    ['networking-all', 'networking-research', 'networking-contacted', 'networking-conversation', 'networking-meetings', 'networking-inactive',
                     'timing-all', 'recent', 'needs', 'approaching', 'overdue', 'nurture', 'cold'].forEach(key => {
                        const countEl = document.getElementById(`count-${key}`);
                        if (countEl) countEl.textContent = '0';
                    });
                }
            }
        }

        // updateDropdowns function removed - using search input instead of dropdowns

        function renderItems() {
            const grid = document.getElementById('unifiedGrid');
            if (!grid) {
                console.error('Grid element not found!');
                return;
            }
            
            // Clear the grid first
            grid.innerHTML = '';
            
            let items = [];
            
            // Get applications if type is 'jobs' or 'both'
            if (currentType === 'jobs' || currentType === 'both') {
                const apps = allData.applications || [];
                items.push(...apps.map(app => ({
                    type: 'application',
                    data: app
                })));
            }
            
            // Get contacts if type is 'networking' or 'both'
            if (currentType === 'networking' || currentType === 'both') {
                const contacts = allData.contacts || [];
                items.push(...contacts.map(contact => ({
                    type: 'contact',
                    data: contact
                })));
            }
            
            // Filter by selected companies (client-side)
            if (currentCompanyFilter.length > 0) {
                items = items.filter(item => {
                    const company = item.data.company || item.data.company_name || '';
                    return currentCompanyFilter.some(selectedCompany => 
                        company.toLowerCase().includes(selectedCompany.toLowerCase())
                    );
                });
            }
            
            console.log('Rendering items:', {
                total: items.length,
                applications: items.filter(i => i.type === 'application').length,
                contacts: items.filter(i => i.type === 'contact').length,
                currentType: currentType,
                selectedCompanies: currentCompanyFilter.length,
                allDataApps: allData.applications?.length || 0,
                allDataContacts: allData.contacts?.length || 0
            });
            
            // Apply sorting
            items = sortItems(items);
            
            if (items.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h2>No items found</h2>
                        <p>Try adjusting your filters</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = items.map(item => {
                if (item.type === 'application') {
                    return createApplicationCard(item.data);
                } else {
                    return createContactTile(item.data);
                }
            }).join('');
            
            console.log('Grid updated with', items.length, 'items');
        }

        function createApplicationCard(app) {
            const flagIcon = app.flagged ? 'üö©' : '‚öê';
            const flagClass = app.flagged ? 'flagged' : '';
            const matchScore = app.match_score ? Math.round(app.match_score) : 0;
            let summaryLink = '#';
            if (app.folder_path && app.summary_filename) {
                summaryLink = `/applications/${app.folder_path}/${app.summary_filename}`;
            } else if (app.summary_path) {
                // Fallback to parsing summary_path
                const pathParts = app.summary_path.split('/');
                if (pathParts.length >= 2) {
                    summaryLink = `/applications/${pathParts[pathParts.length - 2]}/${pathParts[pathParts.length - 1]}`;
                }
            }
            
            return `
                <div class="card" 
                     data-updated-at="${app.status_updated_at}" 
                     data-created-at="${app.created_at}"
                     data-match-score="${matchScore}"
                     data-company="${escapeHtml(app.company)}"
                     data-position="${escapeHtml(app.job_title)}">
                    <div class="card-header">
                        <div class="card-company">
                            ${escapeHtml(app.company)}
                            <span class="match-score">${matchScore}%</span>
                        </div>
                        <button class="flag-btn ${flagClass}" 
                                onclick="toggleAppFlag('${app.id}', ${!app.flagged})" 
                                title="${app.flagged ? 'Unflag' : 'Flag'}">
                            ${flagIcon}
                        </button>
                    </div>
                    <div class="card-title">${escapeHtml(app.job_title)}</div>
                    <div class="card-status">${escapeHtml(app.status)}</div>
                    <div class="card-meta">
                        <div>üìÖ Applied: ${formatDate(app.created_at)}</div>
                        <div>üîÑ Updated: ${formatDate(app.status_updated_at)}</div>
                    </div>
                    <a href="${summaryLink}" class="card-btn">View Summary ‚Üí</a>
                </div>
            `;
        }

        function createContactTile(contact) {
            const matchScore = contact.match_score ? Math.round(contact.match_score) : 0;
            const flagIcon = contact.flagged ? '‚öê' : '‚öë';
            const flagClass = contact.flagged ? 'flagged' : '';
            const nextStep = contact.next_step || 'Review contact status and determine next action';
            const folderName = `${contact.person_name.replace(/\s+/g, '-')}-${contact.company.replace(/\s+/g, '-')}`;
            const summaryFilename = `${contact.person_name.replace(/\s+/g, '-')}-summary.html`;
            
            return `
                <div class="contact-tile timing-${contact.timing_color}"
                     data-updated-at="${contact.status_updated_at}" 
                     data-created-at="${contact.created_at}"
                     data-match-score="${matchScore}"
                     data-company="${escapeHtml(contact.company)}"
                     data-position="${escapeHtml(contact.job_title)}">
                    <div class="contact-header">
                        <h3 class="contact-name">${escapeHtml(contact.person_name)}</h3>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="match-score">${matchScore}%</span>
                            <span class="flag-btn ${flagClass}" onclick="toggleContactFlag('${contact.id}', ${!contact.flagged})">${flagIcon}</span>
                        </div>
                    </div>
                    <div class="contact-company">${escapeHtml(contact.company)}</div>
                    ${contact.job_title ? `<div class="contact-title">${escapeHtml(contact.job_title)}</div>` : ''}
                    <div class="status-badge">${escapeHtml(contact.status)}</div>
                    <div class="next-step-section">
                        <div class="next-step-label">Next Step</div>
                        <div class="next-step-text">${escapeHtml(nextStep)}</div>
                    </div>
                    <div class="contact-dates">
                        <div class="date-row">
                            <span>üìÖ</span>
                            <span>Connected: ${formatDate(contact.created_at)}</span>
                        </div>
                        <div class="date-row">
                            <span>üîÑ</span>
                            <span>Updated: ${formatDate(contact.status_updated_at)}</span>
                        </div>
                        <div class="date-row">
                            <span>‚è∞</span>
                            <span>${contact.days_since_update} days ago</span>
                        </div>
                    </div>
                    <button class="card-btn" onclick="viewContact('${contact.id}')">View Summary</button>
                </div>
            `;
        }

        const sortConfig = {
            'updated_desc': (a, b) => new Date(b.status_updated_at) - new Date(a.status_updated_at),
            'updated_asc': (a, b) => new Date(a.status_updated_at) - new Date(b.status_updated_at),
            'created_desc': (a, b) => new Date(b.created_at) - new Date(a.created_at),
            'created_asc': (a, b) => new Date(a.created_at) - new Date(b.created_at),
            'match_desc': (a, b) => (b.match_score || 0) - (a.match_score || 0),
            'match_asc': (a, b) => (a.match_score || 0) - (b.match_score || 0),
            'company_asc': (a, b) => (a.company || a.company_name || '').localeCompare(b.company || b.company_name || ''),
            'company_desc': (a, b) => (b.company || b.company_name || '').localeCompare(a.company || a.company_name || ''),
            'position_asc': (a, b) => (a.job_title || a.position || '').localeCompare(b.job_title || b.position || ''),
            'position_desc': (a, b) => (b.job_title || b.position || '').localeCompare(a.job_title || a.position || '')
        };

        function sortItems(items) {
            const sortFn = sortConfig[currentSort] || (() => 0);
            return items.sort((a, b) => sortFn(a.data, b.data));
        }

        function setActiveButton(selector, activeElement, callback) {
            document.querySelectorAll(selector).forEach(btn => btn.classList.remove('active'));
            activeElement.classList.add('active');
            if (callback) callback(activeElement);
        }

        function selectType(type) {
            console.log('selectType called with:', type);
            const btn = document.querySelector(`[data-type="${type}"]`);
            if (!btn) {
                console.error('Button not found for type:', type);
                return;
            }
            setActiveButton('[data-type]', btn);
            currentType = type;
            console.log('currentType set to:', currentType);
            
            // Show/hide filter sections based on type
            const appFiltersSection = document.getElementById('appFiltersSection');
            const networkingFiltersSection = document.getElementById('networkingFiltersSection');
            const combinedFiltersBox = document.getElementById('combinedFiltersBox');
            
            // Always show the combined filter box
            combinedFiltersBox.style.display = 'block';
            
            if (type === 'jobs') {
                appFiltersSection.style.display = 'block';
                networkingFiltersSection.style.display = 'none';
            } else if (type === 'networking') {
                appFiltersSection.style.display = 'none';
                networkingFiltersSection.style.display = 'block';
            } else {
                appFiltersSection.style.display = 'block';
                networkingFiltersSection.style.display = 'block';
            }
            
            loadProgressData();
        }
        
        // Make functions globally accessible
        window.selectType = selectType;

        function selectPeriod(period) {
            console.log('selectPeriod called with:', period);
            const btn = document.querySelector(`[data-period="${period}"]`);
            if (!btn) {
                console.error('Button not found for period:', period);
                return;
            }
            setActiveButton('[data-period]', btn);
            currentPeriod = period;
            console.log('currentPeriod set to:', currentPeriod);
            loadProgressData();
        }
        
        // Make functions globally accessible
        window.selectPeriod = selectPeriod;

        function applyFilters() {
            // Company filter is now handled by selected companies array
            loadProgressData();
        }
        
        function handleCompanySearch(event) {
            const input = event.target;
            const query = input.value.toLowerCase().trim();
            
            // Show suggestions if there's a query
            if (query.length > 0) {
                showCompanySuggestions(query);
            } else {
                showCompanySuggestions(''); // Show all when empty
            }
        }
        
        function updateSelectedCompaniesDisplay() {
            const container = document.getElementById('selectedCompanies');
            container.innerHTML = '';
            
            currentCompanyFilter.forEach((company, index) => {
                const tag = document.createElement('div');
                tag.className = 'company-tag';
                tag.innerHTML = `
                    <span>${escapeHtml(company)}</span>
                    <span class="company-tag-remove" data-company-index="${index}" title="Remove">√ó</span>
                `;
                // Add click handler to remove button
                const removeBtn = tag.querySelector('.company-tag-remove');
                removeBtn.onclick = (e) => {
                    e.stopPropagation();
                    removeCompany(index);
                };
                container.appendChild(tag);
            });
        }
        
        function removeCompany(index) {
            if (index >= 0 && index < currentCompanyFilter.length) {
                currentCompanyFilter.splice(index, 1);
                updateSelectedCompaniesDisplay();
                renderItems(); // Re-render with updated filter
            }
        }
        
        function showCompanySuggestions(query = '') {
            const suggestionsDiv = document.getElementById('companySuggestions');
            const companies = allData.companies || [];
            
            if (!query || query.length === 0) {
                // Show all companies if no query (limit to 15 for better UX)
                const filtered = companies.slice(0, 15);
                renderSuggestions(filtered, suggestionsDiv);
            } else {
                // Filter companies based on query
                const filtered = companies
                    .filter(company => company.toLowerCase().includes(query.toLowerCase()))
                    .slice(0, 15); // Limit to 15 suggestions
                renderSuggestions(filtered, suggestionsDiv);
            }
            
            if (suggestionsDiv.children.length > 0) {
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        }
        
        function renderSuggestions(companies, container) {
            container.innerHTML = '';
            
            if (companies.length === 0) {
                const noResults = document.createElement('div');
                noResults.className = 'company-suggestion-item';
                noResults.textContent = 'No companies found';
                noResults.style.color = 'var(--text-secondary)';
                noResults.style.cursor = 'default';
                container.appendChild(noResults);
                return;
            }
            
            companies.forEach(company => {
                const isSelected = currentCompanyFilter.includes(company);
                const item = document.createElement('div');
                item.className = 'company-suggestion-item' + (isSelected ? ' selected' : '');
                item.innerHTML = `
                    <span>${escapeHtml(company)}</span>
                    ${isSelected ? '<span style="margin-left: auto; color: var(--accent-blue);">‚úì</span>' : ''}
                `;
                item.onmousedown = (e) => {
                    // Prevent input blur when clicking suggestion
                    e.preventDefault();
                    toggleCompany(company);
                };
                item.onmouseenter = () => {
                    // Remove highlight from all items
                    container.querySelectorAll('.company-suggestion-item').forEach(el => {
                        el.classList.remove('highlighted');
                    });
                    // Add highlight to current item
                    item.classList.add('highlighted');
                };
                container.appendChild(item);
            });
        }
        
        function toggleCompany(company) {
            if (currentCompanyFilter.includes(company)) {
                // Remove company if already selected
                currentCompanyFilter = currentCompanyFilter.filter(c => c !== company);
            } else {
                // Add company if not selected
                currentCompanyFilter.push(company);
            }
            
            // Clear input
            const input = document.getElementById('companyFilter');
            input.value = '';
            
            // Update display and re-render
            updateSelectedCompaniesDisplay();
            showCompanySuggestions(''); // Refresh suggestions to show updated selection state
            renderItems(); // Re-render with updated filter
        }
        
        function selectCompany(company) {
            // Legacy function for single selection - now uses toggleCompany
            toggleCompany(company);
        }
        
        function handleCompanySearchFocus() {
            const input = document.getElementById('companyFilter');
            const query = input.value;
            showCompanySuggestions(query);
        }
        
        function hideCompanySuggestions() {
            // Use setTimeout to allow click events to fire first
            setTimeout(() => {
                const suggestionsDiv = document.getElementById('companySuggestions');
                if (suggestionsDiv) {
                    suggestionsDiv.style.display = 'none';
                }
            }, 200);
        }
        

        function applySort() {
            currentSort = document.getElementById('sortSelect').value;
            renderItems();
        }

        function setupFilterGroup(selector, callback) {
            document.querySelectorAll(selector + ' .filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll(selector + ' .filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    if (callback) {
                        callback(btn);
                    }
                    // Ensure filter is set before loading data
                    console.log('Filter button clicked, calling loadProgressData');
                    loadProgressData();
                });
            });
        }

        function setupFilterButtons() {
            console.log('Setting up filter buttons...');
            
            // Ensure combined filter box is visible (starts collapsed)
            const combinedFiltersBox = document.getElementById('combinedFiltersBox');
            if (combinedFiltersBox) {
                combinedFiltersBox.style.display = 'block';
                // Keep it collapsed by default (don't remove collapsed class)
            }
            
            const appStatusButtons = document.querySelectorAll('#appStatusFilters .filter-btn');
            console.log('Found app status buttons:', appStatusButtons.length);
            if (appStatusButtons.length === 0) {
                console.warn('No app status buttons found!');
            }
            setupFilterGroup('#appStatusFilters', (btn) => {
                currentStatusFilter = btn.dataset.filter || 'all';
                console.log('App status filter set to:', currentStatusFilter);
            });
            
            // Setup networking status filters (buttons with data-filter-type="networking-status")
            const networkingStatusButtons = document.querySelectorAll('[data-filter-type="networking-status"]');
            console.log('Found networking status buttons:', networkingStatusButtons.length);
            networkingStatusButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active from all networking status buttons
                    networkingStatusButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentNetworkingStatusFilter = btn.dataset.filter || 'all';
                    console.log('Networking status filter set to:', currentNetworkingStatusFilter);
                    loadProgressData();
                });
            });
            
            // Setup timing filters (buttons with data-filter-type="timing")
            const timingButtons = document.querySelectorAll('[data-filter-type="timing"]');
            console.log('Found timing buttons:', timingButtons.length);
            timingButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active from all timing buttons
                    timingButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTimingFilter = btn.dataset.timing || 'all';
                    console.log('Timing filter set to:', currentTimingFilter);
                    loadProgressData();
                });
            });
        }

        function toggleFilterBox(boxId) {
            const box = document.getElementById(boxId);
            box.classList.toggle('collapsed');
        }

        function formatDate(isoString) {
            if (!isoString) return 'N/A';
            const date = new Date(isoString);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric'
            });
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function toggleFlag(id, flagged, type) {
            try {
                const endpoint = type === 'app' 
                    ? `/api/applications/${id}/flag` 
                    : `/api/networking/contacts/${id}/flag`;
                const response = await fetch(endpoint, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ flagged })
                });
                if (response.ok) {
                    loadProgressData();
                }
            } catch (error) {
                console.error('Error toggling flag:', error);
            }
        }

        async function toggleAppFlag(appId, flagged) {
            await toggleFlag(appId, flagged, 'app');
        }

        async function toggleContactFlag(contactId, flagged) {
            await toggleFlag(contactId, flagged, 'contact');
        }

        async function viewContact(contactId) {
            try {
                const response = await fetch(`/api/networking/contacts/${contactId}`);
                const data = await response.json();
                if (data.success && data.contact) {
                    const contact = data.contact;
                    const folderName = `${contact.person_name.replace(/\s+/g, '-')}-${contact.company_name.replace(/\s+/g, '-')}`;
                    const summaryFilename = `${contact.person_name.replace(/\s+/g, '-')}-summary.html`;
                    window.location.href = `/networking/${folderName}/${summaryFilename}`;
                }
            } catch (error) {
                console.error('Error loading contact:', error);
            }
        }

        function exportToCSV() {
            const url = `/api/reports/export-csv?period=${currentPeriod}&type=${currentType}`;
            window.location.href = url;
        }

        async function showAIStatus() {
            try {
                const response = await fetch('/api/check-ollama');
                const data = await response.json();
                alert(`AI Status: ${data.connected ? 'Connected' : 'Not Connected'}\nModel: ${data.current_model || 'N/A'}`);
            } catch (error) {
                console.error('AI Status Error:', error);
            }
        }
    </script>
</body>
</html>

